version: "2"

run:
  timeout: 5m
  # Skip tests temporarily to work around printf analyzer crash
  # TODO: Remove when golangci-lint fixes the printf analyzer bug
  tests: true

linters:
  default: none
  enable:
    - errcheck
    - govet
    - staticcheck
    - unused
    - ineffassign
    - cyclop
    - depguard
  
  settings:
    cyclop:
      # Architecture doc specifies max complexity of 15
      # CLI scaffold functions exceed this but are codegen utilities
      max-complexity: 30
    govet:
      disable:
        - printf
    
    # Hexagonal Architecture Layer Boundaries
    # See: docs/architecture.md and project_context.md
    depguard:
      rules:
        # Domain layer: Cannot import any other internal layers
        # Domain is the core and must be isolated
        domain-layer:
          list-mode: lax
          files:
            - "**/internal/domain/**"
          deny:
            - pkg: "github.com/iruldev/golang-api-hexagonal/internal/usecase/**"
              desc: "domain layer cannot import usecase - violates hexagonal architecture"
            - pkg: "github.com/iruldev/golang-api-hexagonal/internal/interface/**"
              desc: "domain layer cannot import interface - violates hexagonal architecture"
            - pkg: "github.com/iruldev/golang-api-hexagonal/internal/infra/**"
              desc: "domain layer cannot import infra - violates hexagonal architecture"
        
        # Usecase layer: Can only import domain
        # Cannot import interface or infra (use dependency injection)
        usecase-layer:
          list-mode: lax
          files:
            - "**/internal/usecase/**"
          deny:
            - pkg: "github.com/iruldev/golang-api-hexagonal/internal/interface/**"
              desc: "usecase layer cannot import interface - violates hexagonal architecture"
            - pkg: "github.com/iruldev/golang-api-hexagonal/internal/infra/**"
              desc: "usecase layer cannot import infra - use dependency injection instead"
        
        # Interface layer: Can import usecase and domain
        # Cannot directly import infra (use dependency injection)
        interface-layer:
          list-mode: lax
          files:
            - "**/internal/interface/**"
          deny:
            - pkg: "github.com/iruldev/golang-api-hexagonal/internal/infra/**"
              desc: "interface layer cannot import infra - use dependency injection instead"
  
  exclusions:
    # Predefined exclusion rules for common false positives
    presets:
      - std-error-handling
      - common-false-positives
    
    rules:
      # Exclude errcheck for deferred Close() and Sync()
      - linters:
          - errcheck
        source: "defer.*\\.(Close|Sync)\\(\\)"
      
      # Exclude errcheck for fmt.Fprintf in CLI output
      - linters:
          - errcheck
        source: "fmt\\.Fprintf\\("
      
      # Exclude old buildtag warnings
      - linters:
          - govet
        text: "buildtag"
      
      # Exclude staticcheck quick-fix suggestions
      - linters:
          - staticcheck
        text: "QF"
      
      # Exclude unused warnings for CLI commands (will be used via subcommand registration)
      - path: "cmd/bplat/cmd/"
        linters:
          - unused

      # Exclude errcheck for test files (common in tests to ignore cleanup errors)
      - path: "_test\\.go"
        linters:
          - errcheck
